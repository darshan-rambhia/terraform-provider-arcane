---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "arcane_project_deployment Resource - terraform-provider-arcane"
subcategory: ""
description: |-
  Manages the deployment state of an Arcane project.
  This resource triggers deployment operations (up/redeploy) for Docker Compose projects
  in Arcane. It tracks the deployment state and can be used to ensure projects are running.
  Behavior
  Create: Calls the project's deploy (up) endpoint to start the stackUpdate: Calls the project's redeploy endpoint when triggers or options changeDelete: Behavior depends on stop_on_delete:
  false (default): Removes from Terraform state only, containers continue runningtrue: Stops containers (docker compose down) before removing from stateRead: Fetches the current project status
  Example Usage
  Basic Deployment
  
  resource "arcane_project_deployment" "webapp" {
    environment_id = arcane_environment.production.id
    project_id     = data.arcane_project.webapp.id
  }
  
  With Triggers (Recommended)
  
  resource "arcane_project_deployment" "webapp" {
    environment_id = arcane_environment.production.id
    project_id     = data.arcane_project.webapp.id
  
    # Only redeploy when compose or env files change
    triggers = {
      compose = sha256(file("deploy/docker-compose.yml"))
      env     = sha256(local.env_content)
    }
  
    pull           = true
    force_recreate = false
    remove_orphans = true
    stop_on_delete = true
  }
  
  With Wait Timeout
  
  resource "arcane_project_deployment" "webapp" {
    environment_id = arcane_environment.production.id
    project_id     = data.arcane_project.webapp.id
  
    # Wait up to 3 minutes for agent to come online
    wait_timeout = "3m"
  }
  
  Triggering Redeployments
  To force a redeployment, you can use Terraform's replace functionality:
  
  terraform apply -replace="arcane_project_deployment.webapp"
  
  Import
  Deployments can be imported using environment_id/project_id:
  
  terraform import arcane_project_deployment.webapp env-id/project-id
---

# arcane_project_deployment (Resource)

Manages the deployment state of an Arcane project.

This resource triggers deployment operations (up/redeploy) for Docker Compose projects
in Arcane. It tracks the deployment state and can be used to ensure projects are running.

## Behavior

- **Create**: Calls the project's deploy (up) endpoint to start the stack
- **Update**: Calls the project's redeploy endpoint when triggers or options change
- **Delete**: Behavior depends on `stop_on_delete`:
  - `false` (default): Removes from Terraform state only, containers continue running
  - `true`: Stops containers (docker compose down) before removing from state
- **Read**: Fetches the current project status

## Example Usage

### Basic Deployment

```hcl
resource "arcane_project_deployment" "webapp" {
  environment_id = arcane_environment.production.id
  project_id     = data.arcane_project.webapp.id
}
```

### With Triggers (Recommended)

```hcl
resource "arcane_project_deployment" "webapp" {
  environment_id = arcane_environment.production.id
  project_id     = data.arcane_project.webapp.id

  # Only redeploy when compose or env files change
  triggers = {
    compose = sha256(file("deploy/docker-compose.yml"))
    env     = sha256(local.env_content)
  }

  pull           = true
  force_recreate = false
  remove_orphans = true
  stop_on_delete = true
}
```

### With Wait Timeout

```hcl
resource "arcane_project_deployment" "webapp" {
  environment_id = arcane_environment.production.id
  project_id     = data.arcane_project.webapp.id

  # Wait up to 3 minutes for agent to come online
  wait_timeout = "3m"
}
```

## Triggering Redeployments

To force a redeployment, you can use Terraform's replace functionality:

```shell
terraform apply -replace="arcane_project_deployment.webapp"
```

## Import

Deployments can be imported using `environment_id/project_id`:

```shell
terraform import arcane_project_deployment.webapp env-id/project-id
```

## Example Usage

```terraform
# Look up the environment
data "arcane_environment" "production" {
  name = "production"
}

# Look up the project to deploy
data "arcane_project" "webapp" {
  environment_id = data.arcane_environment.production.id
  name           = "webapp"
}

# Deploy the project with default options
resource "arcane_project_deployment" "webapp" {
  environment_id = data.arcane_environment.production.id
  project_id     = data.arcane_project.webapp.id
}

# Deploy another project with all options
resource "arcane_project_deployment" "api" {
  environment_id = data.arcane_environment.production.id
  project_id     = data.arcane_project.api.id

  # Pull latest images before deploying
  pull = true

  # Force recreate containers even if config hasn't changed
  force_recreate = true

  # Remove containers for services not in the compose file
  remove_orphans = true
}

# Output the deployment status
output "webapp_status" {
  value = arcane_project_deployment.webapp.status
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `environment_id` (String) The ID of the environment containing the project.
- `project_id` (String) The ID of the project to deploy.

### Optional

- `force_recreate` (Boolean) Force recreate containers even if configuration hasn't changed. Defaults to `false`.
- `pull` (Boolean) Pull images before deploying. Defaults to `false`.
- `remove_orphans` (Boolean) Remove containers for services not defined in the compose file. Defaults to `false`.
- `stop_on_delete` (Boolean) Stop containers (docker compose down) when this resource is destroyed. Defaults to `false`. Set to `false` for projects containing the Arcane agent to prevent self-destruction.
- `triggers` (Map of String) A map of arbitrary strings that, when changed, will trigger a redeployment. Use this to redeploy only when specific files change, e.g. `{ compose = sha256(file("docker-compose.yml")) }`.
- `wait_timeout` (String) How long to wait for the agent to come online before deploying. Accepts Go duration strings (e.g. `30s`, `2m`, `5m`). Defaults to `2m`.

### Read-Only

- `id` (String) The unique identifier for this deployment (environment_id/project_id).
- `last_deployed_at` (String) The timestamp of the last deployment in RFC3339 format.
- `status` (String) The current status of the project.
