---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "arcane_environment Resource - terraform-provider-arcane"
subcategory: ""
description: |-
  Manages an Arcane environment.
  Environments in Arcane represent Docker daemon connections. Each environment can
  contain multiple projects (docker-compose stacks). When created, an API key (access token)
  is automatically generated for agent authentication.
  Example Usage
  
  resource "arcane_environment" "production" {
    name        = "production"
    api_url     = "http://10.100.1.100:3553"
    description = "Production Docker environment"
  }
  
  # Access the generated access token for agent authentication
  output "env_token" {
    value     = arcane_environment.production.access_token
    sensitive = true
  }
  
  # Use the token in your sidecars module
  module "sidecars" {
    source = "../../modules/lxc-sidecars"
    # ...
    arcane_agent = {
      enabled      = true
      access_token = arcane_environment.production.access_token
    }
  }
  
  Token Rotation
  To rotate the access token, set regenerate_access_token = true:
  
  resource "arcane_environment" "production" {
    name                    = "production"
    regenerate_access_token = true  # Will regenerate on next apply
  }
  
  After apply, the new token will be in access_token and you should set
  regenerate_access_token back to false.
  Import
  Environments can be imported using their ID:
  
  terraform import arcane_environment.production <environment-id>
  
  Note: When importing, the access token is not retrieved from the API. You'll need
  to either regenerate it using regenerate_access_token = true or provide a
  fallback token from 1Password.
---

# arcane_environment (Resource)

Manages an Arcane environment.

Environments in Arcane represent Docker daemon connections. Each environment can
contain multiple projects (docker-compose stacks). When created, an API key (access token)
is automatically generated for agent authentication.

## Example Usage

```hcl
resource "arcane_environment" "production" {
  name        = "production"
  api_url     = "http://10.100.1.100:3553"
  description = "Production Docker environment"
}

# Access the generated access token for agent authentication
output "env_token" {
  value     = arcane_environment.production.access_token
  sensitive = true
}

# Use the token in your sidecars module
module "sidecars" {
  source = "../../modules/lxc-sidecars"
  # ...
  arcane_agent = {
    enabled      = true
    access_token = arcane_environment.production.access_token
  }
}
```

## Token Rotation

To rotate the access token, set `regenerate_access_token = true`:

```hcl
resource "arcane_environment" "production" {
  name                    = "production"
  regenerate_access_token = true  # Will regenerate on next apply
}
```

After apply, the new token will be in `access_token` and you should set
`regenerate_access_token` back to `false`.

## Import

Environments can be imported using their ID:

```shell
terraform import arcane_environment.production <environment-id>
```

**Note:** When importing, the access token is not retrieved from the API. You'll need
to either regenerate it using `regenerate_access_token = true` or provide a
fallback token from 1Password.

## Example Usage

```terraform
# Create an Arcane environment
resource "arcane_environment" "production" {
  name        = "production"
  description = "Production Docker environment"
  use_api_key = true
}

# Create a development environment without API key
resource "arcane_environment" "development" {
  name        = "development"
  description = "Development Docker environment"
  use_api_key = false
}

# Output the access token (only available when use_api_key = true)
output "production_access_token" {
  value     = arcane_environment.production.access_token
  sensitive = true
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `api_url` (String) The URL where the agent will be accessible (e.g., `http://10.100.2.203:3553`). The manager connects to this URL to communicate with the agent.
- `name` (String) The name of the environment. Must be unique.

### Optional

- `description` (String) A description of the environment.
- `regenerate_access_token` (Boolean) Set to `true` to regenerate the access token. The new token will be available in `access_token` after apply. Reset to `false` after regeneration.
- `use_api_key` (Boolean) Whether to require API key authentication for this environment. Defaults to `false`.

### Read-Only

- `access_token` (String, Sensitive) The access token (API key) for this environment. This token has an `arc_` prefix and is used by agents to authenticate with the Arcane manager. Automatically generated on resource creation.
- `id` (String) The unique identifier of the environment.
